# üí∞ Go REST Wallets

–ü—Ä–æ—Å—Ç–æ–π REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –∫–æ—à–µ–ª—å–∫–∞–º–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π PostgreSQL, Docker –∏ —Ç–µ—Å—Ç–∞–º–∏.

## üìå –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ—à–µ–ª—å–∫–µ –ø–æ ID
- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
- –°–Ω—è—Ç–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤:
  - –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –º–µ—Ç–æ–¥–∞ `POST /api/v1/wallet` —Å `operationType: "DEPOSIT"` –∏ –ø—É—Å—Ç—ã–º `walletId`
  - –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–ø–æ–ª–Ω–∏—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ—à–µ–ª—ë–∫
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ ‚Äî –±–æ–ª–µ–µ **7000 RPS**
- Unit-—Ç–µ—Å—Ç—ã –∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `wrk`

---

## üß© –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|------------|----------------|
| Go         | 1.23           |
| PostgreSQL | –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö |
| pgx        | –î—Ä–∞–π–≤–µ—Ä –ë–î     |
| gorilla/mux| –†–æ—É—Ç–∏–Ω–≥        |
| testify    | –î–ª—è unit-—Ç–µ—Å—Ç–æ–≤ |
| Docker     | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è |

---

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª

```bash
cp .env.example .env
```

–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.

---

## üöÄ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
docker-compose up -d
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É `8080`.

---

## üß™ Unit-—Ç–µ—Å—Ç—ã

–¢–µ—Å—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `src/tests`.  
–ü—Ä–æ–≤–µ—Ä—è—é—Ç –ª–æ–≥–∏–∫—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

### –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å:

```bash
go test -v ./src/tests
```

---

## üß± Load Testing —Å –ø–æ–º–æ—â—å—é `wrk`

–î–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É—Ç–∏–ª–∏—Ç–∞ [`wrk`](https://github.com/wg/wrk ).  
–§–∞–π–ª `wrk.lua` –∑–∞–¥–∞—ë—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã POST-–∑–∞–ø—Ä–æ—Å–∞ (`Content-Type`, `body`).

### ‚úÖ GET `/api/v1/wallets/{id}` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞

```bash
$ wrk -t12 -c1000 -d30s http://localhost:8080/api/v1/wallets/14f21088-2613-430d-b412-f82ce3559dcd
Running 30s test @ http://localhost:8080/api/v1/wallets/14f21088-2613-430d-b412-f82ce3559dcd
  12 threads and 1000 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency    31.34ms    5.25ms  92.68ms   88.18%
    Req/Sec     2.66k   375.77    10.25k    83.23%
  954443 requests in 30.08s, 159.29MB read
Requests/sec:  31729.54
Transfer/sec:      5.30MB
```

---

### ‚úÖ POST `/api/v1/wallet` ‚Äî –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ/—Å–Ω—è—Ç–∏–µ

```bash
$ wrk -t12 -c1000 -d30s -s wrk.lua http://localhost:8080/api/v1/wallet
Running 30s test @ http://localhost:8080/api/v1/wallet
  12 threads and 1000 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   135.60ms   17.65ms 312.96ms   91.08%
    Req/Sec   614.85    142.06     1.24k    68.19%
  220220 requests in 30.09s, 36.75MB read
Requests/sec:   7318.56
Transfer/sec:      1.22MB
```

> –°–µ—Ä–≤–∏—Å —É—Å–ø–µ—à–Ω–æ –¥–µ—Ä–∂–∏—Ç –Ω–∞–≥—Ä—É–∑–∫—É:  
> ‚úÖ **GET** ‚Äî –¥–æ **31,729 RPS**  
> ‚úÖ **POST** ‚Äî –¥–æ **7,318 RPS**

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### ‚úÖ –ü–æ–ª—É—á–∏—Ç—å –∫–æ—à–µ–ª—ë–∫

```bash
curl http://localhost:8080/api/v1/wallets/a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11
```

### ‚úÖ –ü–æ–ø–æ–ª–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ—à–µ–ª—ë–∫

```bash
curl -X POST http://localhost:8080/api/v1/wallet \
     -H "Content-Type: application/json" \
     -d '{"walletId":"existing-id","operationType":"DEPOSIT","amount":50}'
```

### ‚úÖ –°–Ω—è—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞

```bash
curl -X POST http://localhost:8080/api/v1/wallet \
     -H "Content-Type: application/json" \
     -d '{"walletId":"existing-id","operationType":"WITHDRAW","amount":30}'
```

### ‚úÖ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ—à–µ–ª—ë–∫

```bash
curl -X POST http://localhost:8080/api/v1/wallet \
     -H "Content-Type: application/json" \
     -d '{"operationType":"DEPOSIT","amount":100}'
```

> –ü—Ä–∏ –ø—É—Å—Ç–æ–º –∏–ª–∏ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º `walletId` ‚Äî –∫–æ—à–µ–ª—ë–∫ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –æ—à–∏–±–æ–∫

### ‚ùå –ö–æ—à–µ–ª—ë–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω

```json
{
  "error": "Wallet not found"
}
```

### ‚ùå –í–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞

```json
{
  "error": "Validation error on field 'id': cannot be empty"
}
```
